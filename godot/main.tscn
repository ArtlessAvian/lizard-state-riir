[gd_scene load_steps=10 format=3 uid="uid://1ug7wykfxdyt"]

[ext_resource type="Script" path="res://test.gd" id="1_7s6h2"]
[ext_resource type="Script" path="res://FloorCamera.gd" id="2_0g4sw"]
[ext_resource type="Texture2D" path="res://tegu.png" id="2_sn4vf"]
[ext_resource type="Shader" path="res://grid.gdshader" id="3_ebqio"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_0i8tf"]
render_priority = 0
shader = ExtResource("3_ebqio")

[sub_resource type="PlaneMesh" id="PlaneMesh_6bpbg"]
material = SubResource("ShaderMaterial_0i8tf")
size = Vector2(1, 1)

[sub_resource type="BoxMesh" id="BoxMesh_mceu6"]
size = Vector3(1, 0.5, 1)

[sub_resource type="MeshLibrary" id="MeshLibrary_1b75v"]
item/0/name = ""
item/0/mesh = SubResource("PlaneMesh_6bpbg")
item/0/mesh_transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0)
item/0/shapes = []
item/0/navigation_mesh_transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0)
item/0/navigation_layers = 1
item/1/name = ""
item/1/mesh = SubResource("BoxMesh_mceu6")
item/1/mesh_transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.25, 0)
item/1/shapes = []
item/1/navigation_mesh_transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0)
item/1/navigation_layers = 1

[sub_resource type="AtlasTexture" id="AtlasTexture_31piw"]
atlas = ExtResource("2_sn4vf")
region = Rect2(0, 0, 40, 40)

[node name="Floor" type="Node3D"]
script = ExtResource("1_7s6h2")

[node name="Camera3D" type="Camera3D" parent="."]
editor_description = "Camera should not rotate, the world should rotate around the camera.
(Figuring out if there's a way to skew the projection matrix instead? Frustrum projection might be a lead but idk.)"
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 20)
projection = 1
size = 20.0
script = ExtResource("2_0g4sw")
metadata/_edit_lock_ = true

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 0.66649, 0.745514, 0, -0.745514, 0.66649, 0, 5, 0)

[node name="WorldSkew" type="Node3D" parent="."]
editor_description = "Skews the world to show things in Z axis from head on. Keeps \"up\" as Y+, so billboard sprites don't clip into walls, but axes are no longer orthogonal.
The yz skew is chosen to keep the floor tiles pixel perfect, tho it doesn't matter too much.
(Actually rotates the z axis. yz is 2/3 and zz is sqrt(5)/3.)"
transform = Transform3D(1, 0, 0, 0, 1, -0.667, 0, 0, 0.745, 0, 0, 0)
rotation_edit_mode = 2

[node name="GridMap" type="GridMap" parent="WorldSkew"]
mesh_library = SubResource("MeshLibrary_1b75v")
cell_size = Vector3(1, 9999, 1)
cell_center_x = false
cell_center_y = false
cell_center_z = false
data = {
"cells": PackedInt32Array(0, 0, 0, 65535, 0, 0, 65535, 65535, 0, 0, 65535, 0, 1, 65535, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 65535, 1, 0, 65534, 1, 0, 65533, 1, 0, 65533, 0, 0, 65533, 65535, 0, 65533, 65534, 0, 65534, 65534, 0, 65535, 65534, 0, 0, 65534, 0, 1, 65534, 0, 2, 65534, 0, 2, 65535, 0, 2, 0, 0, 2, 1, 0, 65534, 65535, 0, 65534, 0, 0, 3, 65534, 0, 3, 65535, 0, 3, 0, 0, 3, 1, 0, 4, 65535, 1, 5, 65535, 1, 6, 65535, 1, 4, 65534, 1, 5, 65534, 1, 6, 65534, 1, 6, 65533, 1, 5, 65533, 1, 4, 65533, 1, 3, 65533, 1, 2, 65533, 1, 1, 65533, 1, 0, 65533, 1, 65535, 65533, 1, 65534, 65533, 1, 65533, 65533, 1)
}
metadata/_edit_lock_ = true
metadata/_editor_floor_ = Vector3(0, -1, 0)

[node name="WorldRotate" type="Node3D" parent="."]
editor_description = "Unlike WorldSkew, this actually does rotate the world, which plays nicely with billboarded sprites. Probably because the axes are still orthogonal.
(The magic x rotation is acos(2/3).)"
transform = Transform3D(1, 0, 0, 0, 0.745476, -0.666532, 0, 0.666532, 0.745476, 0, 0, 0)

[node name="InternalRotation" type="Node3D" parent="WorldRotate"]
editor_description = "Matches local rotation of ../../WorldSkew/Gridmap."

[node name="Entity" type="Node3D" parent="WorldRotate/InternalRotation"]

[node name="Sprite3D" type="Sprite3D" parent="WorldRotate/InternalRotation/Entity"]
offset = Vector2(0, 15)
pixel_size = 0.0417
billboard = 1
texture_filter = 0
texture = SubResource("AtlasTexture_31piw")

[node name="Entity2" type="Node3D" parent="WorldRotate/InternalRotation"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -3)

[node name="Sprite3D" type="Sprite3D" parent="WorldRotate/InternalRotation/Entity2"]
offset = Vector2(0, 15)
pixel_size = 0.0417
billboard = 1
texture_filter = 0
texture = SubResource("AtlasTexture_31piw")

[node name="Entity3" type="Node3D" parent="WorldRotate/InternalRotation"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -1, 0, -3)

[node name="Sprite3D" type="Sprite3D" parent="WorldRotate/InternalRotation/Entity3"]
offset = Vector2(0, 15)
pixel_size = 0.0417
billboard = 1
texture_filter = 0
texture = SubResource("AtlasTexture_31piw")

[node name="Entity4" type="Node3D" parent="WorldRotate/InternalRotation"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -1, 0, 0)

[node name="Sprite3D" type="Sprite3D" parent="WorldRotate/InternalRotation/Entity4"]
offset = Vector2(0, 15)
pixel_size = 0.0417
billboard = 1
texture_filter = 0
texture = SubResource("AtlasTexture_31piw")
